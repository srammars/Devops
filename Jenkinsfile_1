pipeline {
    agent any

    environment {
        MVN_HOME = tool 'maven-3.5.2'
    }

    stages {
        stage('Print Maven Version') {
            steps {
                script {
                    sh "${MVN_HOME}/bin/mvn --version"
                }
            }
        }

        stage('Build and Test') {
            steps {
                script {
                    sh "${MVN_HOME}/bin/mvn clean test"
                }
            }
        }

        stage('Modify and Fail Test') {
            steps {
                script {
                    sh "sed -i 's/expectedValue/newValue/' src/test/java/com/example/demo/DummyTest.java"
                }
            }
        }

        stage('Verify Compilation and Failing Test') {
            steps {
                script {
                    sh "${MVN_HOME}/bin/mvn clean test"
                }
            }
        }

        // Ajoutez d'autres Ã©tapes selon votre besoin

        stage('Publish Test Reports') {
            steps {
                junit '**/target/surefire-reports/*.xml'
            }
        }
    }
}
