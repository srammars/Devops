pipeline {
    agent any

    tools {
        // Remplacez 'Maven' par la version spécifique de Maven configurée dans Jenkins
        maven 'maven-3.5.2'
    }

    stages {
        stage('Checkout') {
            steps {
                checkout scm
            }
        }

        stage('Build') {
            steps {
                script {
                    sh 'mvn clean compile'
                }
            }
        }

        stage('Tests') {
            steps {
                script {
                    // Assurez-vous que les tests produisent des rapports JUnit au bon emplacement
                    sh 'mvn test'
                }
            }
        }

        stage('Test de non-régression') {
            steps {
                script {
                    // Modifier un test pour le faire échouer
                    // ...

                    // Vérifier que la compilation fonctionne
                    sh 'mvn compile'

                    // Vérifier que le test échoue et remonte en KO
                    sh 'mvn test'
                }
            }
        }

        stage('Ignorer le test') {
            steps {
                script {
                    // Ignorer le test via Maven
                    sh 'mvn test -Dtest=CalculatriceTest#testDiv'
                }
            }
        }
    }

    post {
        always {
            // Publier le rapport de tests JUnit
            junit 'target/surefire-reports/*.xml'
        }
    }
}
