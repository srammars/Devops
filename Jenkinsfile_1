pipeline {
    agent any

    stages {
        stage('Build and Test') {
            steps {
                script {
                    // Étape de construction (Maven, Gradle, etc.)
                    sh 'mvn clean test' // Ou './gradlew clean test' pour Gradle
                }
            }
        }

        stage('Modify and Fail Test') {
            steps {
                script {
                    // Modifier intentionnellement le test pour le faire échouer
                    sh "sed -i 's/assertEquals(Integer.valueOf(5), Calculator.add(2, 3))/assertEquals(Integer.valueOf(6), Calculator.add(2, 3))/' src/test/java/CalculatorTest.java"
                }
            }
        }

        stage('Verify Compilation and Failing Test') {
            steps {
                script {
                    // Vérifier que la compilation fonctionne et que le test échoue
                    sh 'mvn clean test'
                }
            }
        }

        stage('Ignore Test') {
            steps {
                script {
                    // Ignorer le test temporairement
                    sh "sed -i '/@Test/,/@Ignore/ s/^/\\/\\/ /' src/test/java/CalculatorTest.java"
                }
            }
        }

        stage('Verify Ignored Test') {
            steps {
                script {
                    // Vérifier que la compilation fonctionne avec le test ignoré
                    sh 'mvn clean test'
                }
            }
        }

        stage('Publish Test Reports') {
            steps {
                // Dépend du plugin utilisé pour la génération des rapports
                // Exemple avec le plugin JUnit
                junit '**/target/surefire-reports/*.xml'
            }
        }
    }
}
