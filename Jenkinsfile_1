pipeline {
    agent any

    stages {
        stage('Build') {
            steps {
                script {
                    // Étape de compilation
                    sh 'mvn clean compile'
                }
            }
        }

        stage('Tests') {
            steps {
                script {
                    // Étape d'exécution des tests
                    sh 'mvn test'
                }
            }
        }

        stage('Test de non-régression') {
            steps {
                script {
                    // Modifier un test pour le faire échouer
                    // ...

                    // Vérifier que la compilation fonctionne
                    sh 'mvn compile'

                    // Vérifier que le test échoue et remonte en KO
                    sh 'mvn test'
                }
            }
        }

        stage('Ignorer le test') {
            steps {
                script {
                    // Ignorer le test via Maven
                    sh 'mvn test -Dtest=CalculatriceTest'
                }
            }
        }
    }

    post {
        always {
            // Publier le rapport de tests JUnit
            junit 'target/surefire-reports/*.xml'
        }
    }
}
