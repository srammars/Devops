pipeline {
    agent any

    // Commentez la section environment si vous n'avez pas besoin de variables d'environnement globales
    // environment {
    //     // Les variables d'environnement globales peuvent être définies ici
    // }

    tools {
        // Remplacez 'Maven' par la version spécifique de Maven configurée dans Jenkins
        maven 'maven-3.5.2'
    }

    stages {
        stage('Checkout') {
            steps {
                // Étape de récupération du code depuis Git
                checkout scm
            }
        }

        stage('Build') {
            steps {
                // Étape de compilation
                script {
                    sh 'mvn clean compile'
                }
            }
        }

        stage('Tests') {
            steps {
                // Étape d'exécution des tests
                script {
                    sh 'mvn test'
                }
            }
        }

        stage('Test de non-régression') {
            steps {
                // Modifier un test pour le faire échouer
                // ...

                // Vérifier que la compilation fonctionne
                script {
                    sh 'mvn compile'
                }

                // Vérifier que le test échoue et remonte en KO
                script {
                    sh 'mvn test'
                }
            }
        }

        stage('Ignorer le test') {
            steps {
                // Ignorer le test via Maven
                script {
                    sh 'mvn test -Dtest=CalculatriceTest#testDiv'
                }
            }
        }
    }

    post {
        always {
            // Publier le rapport de tests JUnit
            junit 'target/surefire-reports/*.xml'
        }
    }
}
