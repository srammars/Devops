pipeline {
    agent any

    stages {
        stage('Install Maven') {
            steps {
                script {
                    // Installer Maven
                    sh 'wget https://apache.mirrors.nublue.co.uk/maven/maven-3/3.8.4/binaries/apache-maven-3.8.4-bin.tar.gz'
                    sh 'tar xf apache-maven-3.8.4-bin.tar.gz'
                    sh 'export M2_HOME=$PWD/apache-maven-3.8.4'
                    sh 'export M2=$M2_HOME/bin'
                    sh 'export PATH=$M2:$PATH'
                }
            }
        }

        stage('Build') {
            steps {
                script {
                    // Étape de compilation
                    sh 'mvn clean compile'
                }
            }
        }

        stage('Tests') {
            steps {
                script {
                    // Étape d'exécution des tests
                    sh 'mvn test'
                }
            }
        }

        stage('Test de non-régression') {
            steps {
                script {
                    // Modifier un test pour le faire échouer
                    // ...

                    // Vérifier que la compilation fonctionne
                    sh 'mvn compile'

                    // Vérifier que le test échoue et remonte en KO
                    sh 'mvn test'
                }
            }
        }

        stage('Ignorer le test') {
            steps {
                script {
                    // Ignorer le test via Maven
                    sh 'mvn test -Dtest=CalculatriceTest#testNomDeLaMethode'
                }
            }
        }
    }

    post {
        always {
            // Publier le rapport de tests JUnit
            junit 'target/surefire-reports/*.xml'
        }
    }
}
