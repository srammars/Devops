pipeline {
    agent any

    options {
        // Les options globales du pipeline peuvent être définies ici
    }

    environment {
        // Les variables d'environnement globales peuvent être définies ici
    }

    tools {
        // Configurez l'outil Maven ici
        maven 'Maven'
    }

    stages {
        stage('Checkout') {
            steps {
                // Étape de récupération du code depuis Git
                checkout scm
            }
        }

        stage('Build') {
            steps {
                // Étape de compilation
                sh 'mvn clean compile'
            }
        }

        stage('Tests') {
            steps {
                // Étape d'exécution des tests
                sh 'mvn test'
            }
        }

        stage('Test de non-régression') {
            steps {
                // Modifier un test pour le faire échouer
                // ...

                // Vérifier que la compilation fonctionne
                sh 'mvn compile'

                // Vérifier que le test échoue et remonte en KO
                sh 'mvn test'
            }
        }

        stage('Ignorer le test') {
            steps {
                // Ignorer le test via Maven
                sh 'mvn test -Dtest=CalculatriceTest#testDiv'
            }
        }
    }

    post {
        always {
            // Publier le rapport de tests JUnit
            junit 'target/surefire-reports/*.xml'
        }
    }
}
