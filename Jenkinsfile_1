pipeline {
    agent any

    tools {
        // Utilisez le nom correct de l'installation Maven dans Jenkins
        maven 'maven-3.5.2'
    }

    stages {
        stage('Build and Test') {
            steps {
                script {
                    // Étape 1: Vérifier que la compilation et les tests sont passants
                    sh "mvn clean test"

                    // Étape 2: Modifier un test pour le faire échouer
                    // Ajoutez votre modification intentionnelle dans le code du test ici

                    // Étape 3: Vérifier que la compilation fonctionne et que le test remonte en KO
                    // Vous pouvez également exécuter seulement les tests sans compilation ici
                    sh "mvn test"

                    // Étape 4: Ignorer le test via Maven
                    // Vous pouvez utiliser l'option -DskipTests pour ignorer les tests
                    sh "mvn clean install -DskipTests"

                    // Étape 5: Publier le rapport de tests
                    junit '**/target/surefire-reports/*.xml'
                }
            }
        }
    }

    post {
        success {
            echo 'Build et tests réussis !'
        }
        failure {
            echo 'Build ou tests échoués.'
        }
    }
}
